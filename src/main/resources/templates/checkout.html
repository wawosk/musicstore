<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasa - MusicStore</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Dodatkowe style dla klikalnych kafelk√≥w */
        .delivery-option, .payment-option {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .delivery-option:hover, .payment-option:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }

        .delivery-option.selected, .payment-option.selected {
            border-color: #007bff;
            background-color: #e7f3ff;
        }

        .delivery-option input[type="radio"],
        .payment-option input[type="radio"] {
            display: none;
        }

        .delivery-option label,
        .payment-option label {
            display: block;
            cursor: pointer;
            margin: 0;
        }

        .delivery-name, .payment-name {
            font-weight: 500;
            display: block;
        }

        .delivery-price, .payment-icon {
            font-weight: bold;
            color: #007bff;
        }

        .delivery-time {
            display: block;
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<main>
    <div class="container">
        <div class="checkout-container">
            <h1>Finalizacja zam√≥wienia</h1>

            <div class="checkout-progress">
                <div class="progress-step active">1. Koszyk</div>
                <div class="progress-step active">2. Dane zamawiajƒÖcego</div>
                <div class="progress-step">3. Podsumowanie</div>
            </div>

            <div class="checkout-content">
                <div class="checkout-form-section">
                    <h2>Dane kontaktowe</h2>
                    <form th:action="@{/checkout/process}" method="post" class="checkout-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="firstName">Imiƒô *</label>
                                <input type="text" id="firstName" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="lastName">Nazwisko *</label>
                                <input type="text" id="lastName" name="lastName" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">Telefon *</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>

                        <h2>Adres dostawy</h2>

                        <div class="form-group">
                            <label for="address">Ulica i numer *</label>
                            <input type="text" id="address" name="address" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="postalCode">Kod pocztowy *</label>
                                <input type="text" id="postalCode" name="postalCode" pattern="[0-9]{2}-[0-9]{3}" placeholder="00-000" required>
                            </div>
                            <div class="form-group">
                                <label for="city">Miasto *</label>
                                <input type="text" id="city" name="city" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="country">Kraj *</label>
                            <select id="country" name="country" required>
                                <option value="">Wybierz kraj</option>
                                <option value="PL" selected>Polska</option>
                                <option value="DE">Niemcy</option>
                                <option value="CZ">Czechy</option>
                                <option value="SK">S≈Çowacja</option>
                                <option value="UA">Ukraina</option>
                            </select>
                        </div>

                        <h2>Spos√≥b dostawy</h2>

                        <div class="delivery-options">
                            <div class="delivery-option selected" data-value="COURIER">
                                <input type="radio" id="delivery1" name="deliveryMethod" value="COURIER" checked>
                                <label for="delivery1">
                                    <span class="delivery-name">Kurier</span>
                                    <span class="delivery-price">$5.99</span>
                                    <span class="delivery-time">Dostawa w 1-2 dni robocze</span>
                                </label>
                            </div>

                            <div class="delivery-option" data-value="PICKUP_POINT">
                                <input type="radio" id="delivery2" name="deliveryMethod" value="PICKUP_POINT">
                                <label for="delivery2">
                                    <span class="delivery-name">Punkt odbioru</span>
                                    <span class="delivery-price">$3.99</span>
                                    <span class="delivery-time">Dostawa w 2-3 dni robocze</span>
                                </label>
                            </div>

                            <div class="delivery-option" data-value="STORE_PICKUP">
                                <input type="radio" id="delivery3" name="deliveryMethod" value="STORE_PICKUP">
                                <label for="delivery3">
                                    <span class="delivery-name">Odbi√≥r osobisty</span>
                                    <span class="delivery-price">$0.00</span>
                                    <span class="delivery-time">Gotowe do odbioru w ciƒÖgu 1 godziny</span>
                                </label>
                            </div>
                        </div>

                        <h2>Metoda p≈Çatno≈õci</h2>

                        <div class="payment-options">
                            <div class="payment-option selected" data-value="CARD">
                                <input type="radio" id="payment1" name="paymentMethod" value="CARD" checked>
                                <label for="payment1">
                                    <span class="payment-name">Karta p≈Çatnicza</span>
                                    <span class="payment-icon">üí≥</span>
                                </label>
                            </div>

                            <div class="payment-option" data-value="BLIK">
                                <input type="radio" id="payment2" name="paymentMethod" value="BLIK">
                                <label for="payment2">
                                    <span class="payment-name">BLIK</span>
                                    <span class="payment-icon">üì±</span>
                                </label>
                            </div>

                            <div class="payment-option" data-value="BANK_TRANSFER">
                                <input type="radio" id="payment3" name="paymentMethod" value="BANK_TRANSFER">
                                <label for="payment3">
                                    <span class="payment-name">Przelew bankowy</span>
                                    <span class="payment-icon">üè¶</span>
                                </label>
                            </div>

                            <div class="payment-option" data-value="CASH_ON_DELIVERY">
                                <input type="radio" id="payment4" name="paymentMethod" value="CASH_ON_DELIVERY">
                                <label for="payment4">
                                    <span class="payment-name">P≈Çatno≈õƒá przy odbiorze</span>
                                    <span class="payment-icon">üí∞</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="notes">Uwagi do zam√≥wienia (opcjonalnie)</label>
                            <textarea id="notes" name="notes" rows="4" placeholder="Dodatkowe uwagi dotyczƒÖce zam√≥wienia..."></textarea>
                        </div>

                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="terms" name="terms" required>
                            <label for="terms">Akceptujƒô regulamin sklepu *</label>
                        </div>

                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="newsletter" name="newsletter">
                            <label for="newsletter">Chcƒô otrzymywaƒá newsletter z nowo≈õciami i promocjami</label>
                        </div>

                        <div class="checkout-actions">
                            <a th:href="@{/cart}" class="btn btn-secondary">‚Üê Wr√≥ƒá do koszyka</a>
                            <button type="submit" class="btn btn-primary">Z≈Ç√≥≈º zam√≥wienie</button>
                        </div>
                    </form>
                </div>

                <div class="order-summary">
                    <h2>Podsumowanie zam√≥wienia</h2>
                    <div class="summary-items">
                        <div th:each="item : ${cartItems}" class="summary-item">
                            <div class="item-info">
                                <span class="item-name" th:text="${item.album.title}"></span>
                                <span class="item-quantity" th:text="'√ó' + ${item.quantity}"></span>
                            </div>
                            <span class="item-price" th:text="'$' + ${item.subtotal}"></span>
                        </div>
                    </div>

                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Warto≈õƒá produkt√≥w:</span>
                            <span th:text="'$' + ${total}"></span>
                        </div>
                        <div class="summary-row">
                            <span>Dostawa:</span>
                            <span>$5.99</span>
                        </div>
                        <div class="summary-row total">
                            <span>Razem do zap≈Çaty:</span>
                            <span th:text="'$' + ${#numbers.formatDecimal(total + 5.99, 1, 2)}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<div th:replace="fragments/footer :: footer"></div>

<script th:src="@{/js/script.js}"></script>

<script>
    // Obs≈Çuga klikalnych kafelk√≥w dostawy
    document.querySelectorAll('.delivery-option').forEach(option => {
        option.addEventListener('click', function() {
            // Usu≈Ñ klasƒô selected ze wszystkich opcji
            document.querySelectorAll('.delivery-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Dodaj klasƒô selected do klikniƒôtej opcji
            this.classList.add('selected');

            // Zaznacz odpowiedni radio button
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;

            // Aktualizuj koszt dostawy
            updateDeliveryCost(radio.value);
        });
    });

    // Obs≈Çuga klikalnych kafelk√≥w p≈Çatno≈õci
    document.querySelectorAll('.payment-option').forEach(option => {
        option.addEventListener('click', function() {
            // Usu≈Ñ klasƒô selected ze wszystkich opcji
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Dodaj klasƒô selected do klikniƒôtej opcji
            this.classList.add('selected');

            // Zaznacz odpowiedni radio button
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
        });
    });

    function updateDeliveryCost(method) {
        let deliveryCost = 0;
        switch(method) {
            case 'COURIER':
                deliveryCost = 5.99;
                break;
            case 'PICKUP_POINT':
                deliveryCost = 3.99;
                break;
            case 'STORE_PICKUP':
                deliveryCost = 0.00;
                break;
        }

        document.querySelector('.summary-row:nth-child(2) span:last-child').textContent = '$' + deliveryCost.toFixed(2);
        const productTotal = parseFloat(document.querySelector('.summary-row:first-child span:last-child').textContent.replace('$', ''));
        const total = productTotal + deliveryCost;
        document.querySelector('.summary-row.total span:last-child').textContent = '$' + total.toFixed(2);
    }
</script>
</body>
</html>